#!/bin/sh

# Pre-commit hook to prevent committing API keys and other secrets.

# Patterns to search for
PATTERNS="key|secret"

# Files to exclude from the search
EXCLUDE_FILES="google-services.json|GoogleService-Info.plist|pre-commit"

# Get the list of staged files
STAGED_FILES=$(git diff --cached --name-only)

# Flag to indicate if a secret was found
SECRET_FOUND=0

for FILE in $STAGED_FILES
do
  # Check if the file should be excluded
  if echo "$FILE" | grep -qE "$EXCLUDE_FILES"; then
    continue
  fi

  # Search for patterns in the file
  if grep -qE "$PATTERNS" "$FILE"; then
    echo "Error: Found a potential secret in $FILE."
    echo "Please remove the secret before committing."
    SECRET_FOUND=1
  fi
done

if [ "$SECRET_FOUND" -eq 1 ]; then
  exit 1
fi

exit 0
